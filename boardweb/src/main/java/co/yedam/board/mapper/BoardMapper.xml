<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당되는 클래스에 정의 -->
<mapper namespace="co.yedam.board.mapper.BoardMapper">

	<select id="boardList" resultType="board" parameterType="search">
		select rn,
		board_no,
		title,
		content,
		writer,
		view_cnt,
		create_date
		from (
		select /*+ INDEX (b board_pk) */ rownum rn, b. *
		from tbl_board b
		
		<where>
			<choose>
				<when test="searchCondition == 'T'.toString()"> <!-- 조건은 무조건 test -->
					 title like '%'||#{keyword}||'%'
				</when>
				<when test="searchCondition == 'W'.toString()">
					 writer like '%'||#{keyword}||'%'
				</when>
				<when test="searchCondition == 'TW'.toString()">
					a (title like '%'||#{keyword}||'%' or writer like
					'%'||#{keyword}||'%')
				</when>
			</choose>
    				<![CDATA[
    				and rownum <= (#{page} * 5) 
    				]]>
		</where>
		) a
		where a.rn > (#{page} -1) * 5

	</select>

	<select id="getTotalCnt" resultType="int" parameterType="search">
		select count(*)
		from tbl_board
		<where>
		<choose>
			<when test="searchCondition == 'T'.toString()"> <!-- 조건은 무조건 test -->
				 title like '%'||#{keyword}||'%'
			</when>
			<when test="searchCondition == 'W'.toString()">
				 writer like '%'||#{keyword}||'%'
			</when>
			<when test="searchCondition == 'TW'.toString()">
				 (title like '%'||#{keyword}||'%' or writer like
				'%'||#{keyword}||'%')
			</when>
		</choose>
		</where>
	</select>
	
	<select id="selectBoard" resultType="board" parameterType="int">
		select board_no,
			   title,
			   content,
			   writer,
			   view_cnt,
			   create_date
		from   tbl_board
		where  board_no = #{bno}
	</select>	



</mapper>